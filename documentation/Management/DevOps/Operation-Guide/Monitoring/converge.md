# Aggregation Configuration

We most often need to focus on a number of groups or an application, and the summary value of one monitoring item. This is when aggregation configuration can be used. The function of the aggregation configuration is to aggregate one or more monitoring indicators according to the APP or system scopes, the monitored object being no longer a single machine or an instance, so as to achieve business level monitoring.

It includes primary aggregation and secondary aggregation, wherein,

**Primary aggregation:** Collect the monitoring values of multiple ns and pay attention to the data statistics under the summary dimension. Primary aggregation is performed within the scope of the application.

**Secondary aggregation**: Perform mathematical calculations on the monitoring indicators that have been through primary aggregation to obtain monitoring indicators directly related to the actual business, and further monitor and alarm the business conditions.

*Example: When calculating a certain type of error rate, firstly aggregate the error amount and traffic by primary aggregation, then calculate error rate by secondary aggregation.*

## Operation Guide


**(1) Primary Aggregation**

Select the application node to be aggregated in the service tree, then select [Intelligent monitoring] - [monitoring configuration] from the menu, click to access Aggregation Configuration page, select "Primary Aggregation" in the drop-down box at the left side, then click **Create**.

Open Create window of primary aggregation as shown in the figure,

Name: Name of the primary aggregation. Note that the name is used only for identifying aggregation configuration. The name of the monitoring item generated by aggregation is represented in the form of "the name of the monitoring item to be aggregated/aggregation dimension".

Scope, node: Select the application that needs primary aggregation

Monitoring modes and monitoring items: Select the monitoring items to be aggregated

Aggregation method: aggregation is based on application by default. In addition, aggregation is supported by dimensions of group, machine room and other monitoring item tags, even free combination of several dimensions.

E.g., if aggregation of cpu.idle under the application is based on the dimensions of application and group, minimum value of cpu.idle under the application or a certain group can be viewed.

![image](https://github.com/jdcloudcom/cn/blob/DevOps/image/DevOps/Operation-Guide37.JPG)

**(2) Secondary Aggregation**

Select the application or system node to be aggregated in the service tree, then select [Intelligent monitoring] - [monitoring configuration] from the menu, click to access Aggregation Configuration page, select "Secondary Aggregation" in the drop-down box at the left side, then click **New**.

Open JSON Configuration window of secondary aggregation as shown in the figure,

The function of groupByTags: Items to be aggregated have a certain tag which all its values can be used by entering key, as the separation here.

derives: A part for mathematical calculation. Metric in derives: names the monitoring items generated by secondary aggregation. Name is defined by the user, which only supports letters, numbers and underline _.

appendTags: tag name of monitoring items generated by secondary aggregation, with the format of key = value, e.g.: \_group = group1.

formula: Mathematical formulas can be entered for monitoring indicators operation, supporting basic mathematical operation \+, \-, \*.

cycle: Aggregation cycle shall be fully accordance with acquisition cycle of calculative monitoring indicators, with each acquisition cycle must to be equal.

items: Enter calculative monitoring indicators by forms of array. APP that the monitoring indicators belong to need to be entered in ns. Monitoring indicators are entered in metric while tag cannot be entered here. defaulValue is a default value which is 0 by default when there is no data for acquisition. Alias is an alias for this operator, facilitating the calculation for the following mathematical formula, t0, t1, t2... are acceptable. When the value of useDefaultValue is true, it means to use defaultValue, vice versa. keys and values of monitoring indicators are entered in filterTags, with the format referring to the template. nst presents the type of ns, which is APP and needs no modification.

![image](https://github.com/jdcloudcom/cn/blob/DevOps/image/DevOps/Operation-Guide38.JPG)
