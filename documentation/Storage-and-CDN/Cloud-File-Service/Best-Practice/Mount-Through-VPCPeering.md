# Storage of cross-VPC attached files is realized through peering connection



# Preparatory Work

1. Create file storage in VPC, create attached target in the VPC, and can use the existing file storage. For the convenience of description, the VPC to which the target is attached is hereinafter referred to as "VPC 1". In the "Console" - "Cloud File Service" - "File Storage" page, click the file storage ID requiring cross-VPC access and confirm the status of the file storage and its attached target is "available".

For creation of file storage, please see "Create File Storage<https://docs.jdcloud.com/en/cloud-file-service/creating-file-system>"

2. As peering connection (VPC Peering) requires that the VPC CIDRs at both terminals of peering connection cannot overlap, it is required to view, in the "Console" - "VPC" - "VPC" list page, whether the CIDR of the VPC to which the file storage target is attached overlaps with that of the VPC at the other terminal of peering connection. For the convenience of description, the VPC requiring accessing file storage at the other terminal of peering connection is hereinafter referred to as "VPC 2".

![VPCcheck](../../../../image/Cloud-File-Service/VPCpeering_VPCcheck.png)

If the VPC at the other terminal of peering connection is not created, you can refer to the contents of "Create VPC" in "VPC Configuration (<https://docs.jdcloud.com/en/virtual-private-cloud/vpc-configuration>)" for creation. Please note that the CIDR cannot overlap with the CIDR of the VPC to which the target is attached for file storage.

Here is a little practical skill: In general actual businesses, a VM instance requiring cross-VPC access to file storage may already exist or is in use, and "peering connection" requires that the CIDRs of two VPCs cannot overlap. In order not to migrate existing Virtual Machines, a VPC can be created to create the attached target of the file storage in the created VPC, so as to avoid influence on existing Virtual Machines. No extra costs will be generated by the use of peering connection, and there is basically no influence on file storage access performance.

# Operation Steps

## 1. Create peering connection

For details of the Operation Guide, see: VPC Peering Connection (https://docs.jdcloud.com/en/virtual-private-cloud/vpc-peering-configuration)

Interconnection of two VPCs must be realized upon the completion of creating two peering connections from VPC1 to VPC2 and from VPC2 to VPC1.

First create the peering connection from VPC 1 to VPC 2:

1) Select the same region as the location of file storage;

2) VPC at the home terminal selects the VPC1 (VPC to which the target is attached) based on VPC name;

3) VPC ID at the opposite terminal selects the VPC ID of VPC2 (VPC where the Virtual Machine at the opposite terminal is located), which can be viewed after clicking the VPCid in Console VPC;

4) Click **OK** after filling is completed, and a notification will be given for whether the route is configured. Then, click **Go to Configuration** for configuration;

5) Find the route table currently associated with VPC1 in the "Route Table" page based on the "Hosting VPC" in the list, click **Edit** to edit the route table.

Target terminal: CIDR or range of the subnet where VPC2 or attached target is located;

Type of next hop: Select VPC Peering;

Next hop: Previously created peering connection from VPC 1 to VPC 2.

6) Click **Save** to complete route policy creation.

Then create the peering connection from VPC 2 to VPC1 with the same steps as above. Please note that VPC2 is selected for the VPC at the home terminal; VPD ID of VPC1 shall be filled in for the ID at the opposite terminal; the "target terminal" in the route policy shall be filled in with the CIDR or range of VPC1.

 

## 2. Attach file storage in VPC2

For the detailed Operation Guide, see: Attach File Storage (https://docs.jdcloud.com/en/cloud-file-service/mount-file-system)  

Log in to the Virtual Machine to which the file storage shall be attached in the VPC2, and attach the file storage as per the method set forth in the Operation Guide. During the execution of attachment command, the attached target IP is the IP of the attached target in VPC2.

## 3. Verify attachment status

After the attachment, run df -h on the Virtual Machine in VPC2. When you can see the file storage in the FileSystem, the attachment succeeds.
